<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Gestion du Site</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0f0f1a;
            --bg-secondary: #1a1a2e;
            --bg-card: #16213e;
            --accent: #e94560;
            --accent-green: #00d09c;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        h1 {
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-success {
            background: var(--accent-green);
            color: var(--bg-primary);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 1rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1rem;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .tab.active,
        .tab:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
        }

        .card h3 {
            margin-bottom: 1rem;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .menu-type-toggle {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .toggle-option {
            flex: 1;
            padding: 1rem;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .toggle-option.active {
            border-color: var(--accent);
            background: rgba(233, 69, 96, 0.1);
        }

        .toggle-option h4 {
            margin-bottom: 0.5rem;
        }

        .toggle-option p {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .menu-items-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .menu-item-row {
            display: grid;
            grid-template-columns: 1fr 2fr 100px 80px;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-card);
            border-radius: 10px;
            align-items: center;
        }

        .menu-item-row input {
            padding: 0.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 5px;
            color: var(--text-primary);
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            width: 35px;
            height: 35px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        .category-section {
            margin-bottom: 2rem;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .alert {
            padding: 1rem 1.5rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: none;
        }

        .alert-success {
            background: rgba(0, 208, 156, 0.1);
            border: 1px solid var(--accent-green);
            color: var(--accent-green);
        }

        .file-upload {
            border: 2px dashed var(--border);
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: var(--accent);
        }

        .file-upload input {
            display: none;
        }

        .current-pdf {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg-card);
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        @media (max-width: 768px) {
            .menu-item-row {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>‚öôÔ∏è Administration</h1>
            <div class="header-actions">
                <a href="index.html" class="btn btn-secondary">üëÅÔ∏è Voir le site</a>
                <button class="btn btn-success" id="save-all">üíæ Sauvegarder</button>
            </div>
        </header>

        <div class="alert alert-success" id="alert">
            ‚úÖ Modifications sauvegard√©es !
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="general">üìã G√©n√©ral</button>
            <button class="tab" data-tab="menu">üçΩÔ∏è Menu</button>
            <button class="tab" data-tab="hours">üïê Horaires</button>
            <button class="tab" data-tab="contact">üìû Contact</button>
        </div>

        <!-- GENERAL TAB -->
        <div class="tab-content active" id="tab-general">
            <div class="card">
                <h3>Informations g√©n√©rales</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Nom de l'√©tablissement</label>
                        <input type="text" id="businessName">
                    </div>
                    <div class="form-group">
                        <label>Type d'√©tablissement</label>
                        <select id="businessType">
                            <option value="restaurant">Restaurant</option>
                            <option value="boulangerie">Boulangerie</option>
                            <option value="coiffeur">Coiffeur</option>
                            <option value="autre">Autre</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Slogan</label>
                    <input type="text" id="slogan">
                </div>
                <div class="form-group">
                    <label>Description (√Ä propos)</label>
                    <textarea id="description"></textarea>
                </div>
            </div>

            <div class="card">
                <h3>R√©seaux sociaux</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>üìò Facebook</label>
                        <input type="url" id="facebook" placeholder="https://facebook.com/...">
                    </div>
                    <div class="form-group">
                        <label>üì∑ Instagram</label>
                        <input type="url" id="instagram" placeholder="https://instagram.com/...">
                    </div>
                    <div class="form-group">
                        <label>üç¥ TripAdvisor</label>
                        <input type="url" id="tripadvisor" placeholder="https://tripadvisor.com/...">
                    </div>
                </div>
            </div>
        </div>

        <!-- MENU TAB -->
        <div class="tab-content" id="tab-menu">
            <div class="card">
                <h3>Type de menu</h3>
                <div class="menu-type-toggle">
                    <div class="toggle-option active" data-type="pdf">
                        <h4>üìÑ Menu PDF</h4>
                        <p>Uploadez votre menu en PDF</p>
                    </div>
                    <div class="toggle-option" data-type="page">
                        <h4>üìã Menu Page</h4>
                        <p>G√©rez les items directement</p>
                    </div>
                </div>
            </div>

            <!-- PDF Option -->
            <div class="card" id="menu-pdf-config">
                <h3>Menu PDF</h3>
                <div class="file-upload" id="pdf-upload">
                    <input type="file" id="pdf-file" accept=".pdf">
                    <p>üìÑ Cliquez pour uploader un PDF</p>
                    <p style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 0.5rem;">
                        ou glissez-d√©posez le fichier ici
                    </p>
                </div>
                <div class="current-pdf" id="current-pdf" style="display: none;">
                    <span>üìÑ</span>
                    <span id="pdf-name">menu.pdf</span>
                    <button class="btn btn-secondary btn-small" onclick="openPdf()">Voir</button>
                    <button class="btn btn-danger btn-small" onclick="removePdf()">Supprimer</button>
                </div>
                <div class="form-group" style="margin-top: 1rem;">
                    <label>Ou entrez une URL vers le PDF</label>
                    <input type="url" id="menuPdfUrl" placeholder="https://example.com/menu.pdf">
                </div>
            </div>

            <!-- Page Option -->
            <div class="card" id="menu-page-config" style="display: none;">
                <h3>Items du menu</h3>

                <div class="category-section" data-category="entrees">
                    <div class="category-header">
                        <h4>ü•ó Entr√©es</h4>
                        <button class="btn btn-secondary btn-small" onclick="addMenuItem('entrees')">+ Ajouter</button>
                    </div>
                    <div class="menu-items-list" id="items-entrees"></div>
                </div>

                <div class="category-section" data-category="plats">
                    <div class="category-header">
                        <h4>üçΩÔ∏è Plats</h4>
                        <button class="btn btn-secondary btn-small" onclick="addMenuItem('plats')">+ Ajouter</button>
                    </div>
                    <div class="menu-items-list" id="items-plats"></div>
                </div>

                <div class="category-section" data-category="desserts">
                    <div class="category-header">
                        <h4>üç∞ Desserts</h4>
                        <button class="btn btn-secondary btn-small" onclick="addMenuItem('desserts')">+ Ajouter</button>
                    </div>
                    <div class="menu-items-list" id="items-desserts"></div>
                </div>

                <div class="category-section" data-category="boissons">
                    <div class="category-header">
                        <h4>üç∑ Boissons</h4>
                        <button class="btn btn-secondary btn-small" onclick="addMenuItem('boissons')">+ Ajouter</button>
                    </div>
                    <div class="menu-items-list" id="items-boissons"></div>
                </div>
            </div>
        </div>

        <!-- HOURS TAB -->
        <div class="tab-content" id="tab-hours">
            <div class="card">
                <h3>üåÖ Horaires du d√©jeuner</h3>
                <div id="hours-lunch-editor"></div>
                <button class="btn btn-secondary btn-small" style="margin-top: 1rem;" onclick="addHourRow('lunch')">+
                    Ajouter une ligne</button>
            </div>
            <div class="card">
                <h3>üåô Horaires du d√Æner</h3>
                <div id="hours-dinner-editor"></div>
                <button class="btn btn-secondary btn-small" style="margin-top: 1rem;" onclick="addHourRow('dinner')">+
                    Ajouter une ligne</button>
            </div>
        </div>

        <!-- CONTACT TAB -->
        <div class="tab-content" id="tab-contact">
            <div class="card">
                <h3>Coordonn√©es</h3>
                <div class="form-group">
                    <label>üìç Adresse</label>
                    <textarea id="address" rows="2"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>üìû T√©l√©phone</label>
                        <input type="tel" id="phone">
                    </div>
                    <div class="form-group">
                        <label>‚úâÔ∏è Email</label>
                        <input type="email" id="email">
                    </div>
                </div>
                <div class="form-group">
                    <label>üó∫Ô∏è Recherche Google Maps</label>
                    <input type="text" id="mapsQuery" placeholder="Nom + Adresse pour la recherche Maps">
                </div>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script>
        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
            });
        });

        // Menu type toggle
        document.querySelectorAll('.toggle-option').forEach(opt => {
            opt.addEventListener('click', () => {
                document.querySelectorAll('.toggle-option').forEach(o => o.classList.remove('active'));
                opt.classList.add('active');

                const type = opt.dataset.type;
                document.getElementById('menu-pdf-config').style.display = type === 'pdf' ? 'block' : 'none';
                document.getElementById('menu-page-config').style.display = type === 'page' ? 'block' : 'none';
            });
        });

        // Load config into form
        function loadConfig() {
            const config = SiteConfig.get();

            document.getElementById('businessName').value = config.businessName || '';
            document.getElementById('businessType').value = config.businessType || 'restaurant';
            document.getElementById('slogan').value = config.slogan || '';
            document.getElementById('description').value = config.description || '';
            document.getElementById('facebook').value = config.facebook || '';
            document.getElementById('instagram').value = config.instagram || '';
            document.getElementById('tripadvisor').value = config.tripadvisor || '';
            document.getElementById('address').value = config.address || '';
            document.getElementById('phone').value = config.phone || '';
            document.getElementById('email').value = config.email || '';
            document.getElementById('mapsQuery').value = config.mapsQuery || '';
            document.getElementById('menuPdfUrl').value = config.menuPdfUrl || '';

            // Menu type
            const menuType = config.menuType || 'pdf';
            document.querySelectorAll('.toggle-option').forEach(o => {
                o.classList.toggle('active', o.dataset.type === menuType);
            });
            document.getElementById('menu-pdf-config').style.display = menuType === 'pdf' ? 'block' : 'none';
            document.getElementById('menu-page-config').style.display = menuType === 'page' ? 'block' : 'none';

            // Hours
            renderHoursEditor('lunch', config.hours?.lunch || []);
            renderHoursEditor('dinner', config.hours?.dinner || []);

            // Menu items
            renderMenuItems();
        }

        // Render hours editor
        function renderHoursEditor(type, hours) {
            const container = document.getElementById(`hours-${type}-editor`);
            container.innerHTML = hours.map((h, i) => `
                <div class="form-row" style="margin-bottom: 0.5rem;">
                    <input type="text" value="${h.days}" placeholder="Jours" onchange="updateHour('${type}', ${i}, 'days', this.value)">
                    <input type="text" value="${h.time}" placeholder="Horaires" onchange="updateHour('${type}', ${i}, 'time', this.value)">
                    <button class="btn btn-danger btn-icon" onclick="removeHourRow('${type}', ${i})">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        // Render menu items
        function renderMenuItems() {
            const items = MenuData.getItems();
            const categories = ['entrees', 'plats', 'desserts', 'boissons'];

            categories.forEach(cat => {
                const container = document.getElementById(`items-${cat}`);
                const catItems = items.filter(i => i.category === cat);

                container.innerHTML = catItems.map(item => `
                    <div class="menu-item-row">
                        <input type="text" value="${item.name}" placeholder="Nom" onchange="updateMenuItem(${item.id}, 'name', this.value)">
                        <input type="text" value="${item.description}" placeholder="Description" onchange="updateMenuItem(${item.id}, 'description', this.value)">
                        <input type="number" step="0.01" value="${item.price}" placeholder="Prix" onchange="updateMenuItem(${item.id}, 'price', parseFloat(this.value))">
                        <button class="btn btn-danger btn-icon" onclick="deleteMenuItem(${item.id})">üóëÔ∏è</button>
                    </div>
                `).join('');
            });
        }

        // Save all
        document.getElementById('save-all').addEventListener('click', () => {
            const activeType = document.querySelector('.toggle-option.active').dataset.type;

            // Get current config to preserve data URL
            const currentConfig = SiteConfig.get();
            const inputPdfUrl = document.getElementById('menuPdfUrl').value;

            // Preserve data URL if exists, otherwise use input value (for http URLs)
            let finalPdfUrl = currentConfig.menuPdfUrl;
            if (inputPdfUrl && inputPdfUrl.startsWith('http')) {
                finalPdfUrl = inputPdfUrl;
            } else if (!inputPdfUrl || inputPdfUrl === '') {
                finalPdfUrl = '';
            }
            // If inputPdfUrl starts with '[Fichier local:', keep the current data URL

            const config = {
                businessName: document.getElementById('businessName').value,
                businessType: document.getElementById('businessType').value,
                slogan: document.getElementById('slogan').value,
                description: document.getElementById('description').value,
                facebook: document.getElementById('facebook').value,
                instagram: document.getElementById('instagram').value,
                tripadvisor: document.getElementById('tripadvisor').value,
                address: document.getElementById('address').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                mapsQuery: document.getElementById('mapsQuery').value,
                menuPdfUrl: finalPdfUrl,
                menuType: activeType,
                hours: {
                    lunch: getHoursFromEditor('lunch'),
                    dinner: getHoursFromEditor('dinner')
                }
            };

            SiteConfig.save(config);
            showAlert();
        });

        function getHoursFromEditor(type) {
            const container = document.getElementById(`hours-${type}-editor`);
            const rows = container.querySelectorAll('.form-row');
            return Array.from(rows).map(row => {
                const inputs = row.querySelectorAll('input');
                return { days: inputs[0].value, time: inputs[1].value };
            });
        }

        function addHourRow(type) {
            const config = SiteConfig.get();
            config.hours = config.hours || { lunch: [], dinner: [] };
            config.hours[type].push({ days: '', time: '' });
            SiteConfig.save(config);
            renderHoursEditor(type, config.hours[type]);
        }

        function removeHourRow(type, index) {
            const config = SiteConfig.get();
            config.hours[type].splice(index, 1);
            SiteConfig.save(config);
            renderHoursEditor(type, config.hours[type]);
        }

        function updateHour(type, index, field, value) {
            const config = SiteConfig.get();
            config.hours[type][index][field] = value;
            SiteConfig.save(config);
        }

        // Menu item functions
        function addMenuItem(category) {
            MenuData.addItem({
                category: category,
                name: 'Nouveau plat',
                description: 'Description',
                price: 0
            });
            renderMenuItems();
        }

        function updateMenuItem(id, field, value) {
            MenuData.updateItem(id, { [field]: value });
        }

        function deleteMenuItem(id) {
            if (confirm('Supprimer cet item ?')) {
                MenuData.deleteItem(id);
                renderMenuItems();
            }
        }

        function showAlert() {
            const alert = document.getElementById('alert');
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 3000);
        }

        // PDF Upload handlers
        const pdfUpload = document.getElementById('pdf-upload');
        const pdfFile = document.getElementById('pdf-file');

        // Click on upload zone triggers file input
        pdfUpload.addEventListener('click', () => {
            pdfFile.click();
        });

        // Handle file selection
        pdfFile.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.type === 'application/pdf') {
                // For demo, we'll use a data URL (in production, upload to server)
                const reader = new FileReader();
                reader.onload = (event) => {
                    const config = SiteConfig.get();
                    config.menuPdfUrl = event.target.result;
                    SiteConfig.save(config);

                    // Show current PDF info
                    document.getElementById('current-pdf').style.display = 'flex';
                    document.getElementById('pdf-name').textContent = file.name;
                    document.getElementById('menuPdfUrl').value = `[Fichier local: ${file.name}]`;

                    showAlert();
                };
                reader.readAsDataURL(file);
            } else {
                alert('Veuillez s√©lectionner un fichier PDF valide.');
            }
        });

        // Open current PDF
        function openPdf() {
            const config = SiteConfig.get();
            if (config.menuPdfUrl) {
                window.open(config.menuPdfUrl, '_blank');
            }
        }

        // Remove PDF
        function removePdf() {
            const config = SiteConfig.get();
            config.menuPdfUrl = '';
            SiteConfig.save(config);
            document.getElementById('current-pdf').style.display = 'none';
            document.getElementById('menuPdfUrl').value = '';
            showAlert();
        }

        // Init
        loadConfig();

        // Check if PDF already exists
        const config = SiteConfig.get();
        if (config.menuPdfUrl && config.menuPdfUrl.length > 0) {
            document.getElementById('current-pdf').style.display = 'flex';
            if (config.menuPdfUrl.startsWith('data:')) {
                document.getElementById('pdf-name').textContent = 'menu.pdf (local)';
            }
        }
    </script>
</body>

</html>